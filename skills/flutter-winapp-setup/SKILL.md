# /flutter-winapp-setup

Initialize Microsoft WinApp CLI environment for Flutter Windows development. WinApp CLI is a unified command-line tool for Windows app development released in January 2026.

## Usage

```
/flutter-winapp-setup [options]
```

## Options

- `--check`: Check WinApp CLI installation status only
- `--update`: Update WinApp CLI to latest version
- `--cert`: Generate development certificate after setup
- `--ci`: Generate CI/CD workflow only (for macOS/Linux developers)

## Examples

```
/flutter-winapp-setup
/flutter-winapp-setup --check
/flutter-winapp-setup --cert
/flutter-winapp-setup --ci
```

## Instructions

When the user invokes `/flutter-winapp-setup`, follow these steps:

### 0. Detect Platform

First, determine the development platform:

```bash
# Check operating system
uname -s  # Darwin = macOS, Linux = Linux
# On Windows, this command won't exist or will return different output
```

**Platform-specific paths:**
- **Windows**: Full local WinApp CLI setup (Steps 1-7)
- **macOS/Linux**: CI/CD workflow generation (Steps 8-11)

---

## Windows Setup (Steps 1-7)

### 1. Check Prerequisites

```powershell
# Check if winget is available
winget --version

# If not available, install App Installer from Microsoft Store
# Or download from: https://github.com/microsoft/winget-cli/releases
```

### 2. Check Existing Installation

```powershell
# Check if WinApp CLI is installed
winapp --version

# Expected output: winapp 1.x.x
```

### 3. Install WinApp CLI

```powershell
# Install via winget
winget install Microsoft.winappcli --source winget

# Alternative: Install via MSI
# Download from https://github.com/microsoft/winappCli/releases
```

### 4. Initialize Workspace

```powershell
# Initialize WinApp CLI in your Flutter project
winapp init

# This bootstraps the workspace with:
# - Required Windows SDKs
# - Build tools configuration
# - Default settings
```

### 5. Verify Installation

```powershell
# Check SDK paths are configured
winapp get-winapp-path

# Verify environment
winapp restore
```

### 6. Generate Development Certificate (if --cert)

```powershell
# Generate self-signed certificate for development
winapp cert generate

# This creates:
# - Development certificate in user store
# - Auto-configured for MSIX signing

# View generated certificate
winapp cert list
```

### 7. Output Summary (Windows)

```
WinApp CLI Setup Complete
=========================

Platform: Windows
WinApp CLI Version: 1.x.x
Installation: winget

Configuration:
- SDK Path: C:\Program Files\Windows Kits\10
- Certificate: Generated (if --cert used)

Available Commands:
- winapp init          # Bootstrap workspace
- winapp restore       # Restore environment
- winapp cert generate # Create dev certificate
- winapp sign          # Sign executables/MSIX
- winapp pack          # Package as MSIX
- winapp create-debug-identity  # Add package identity
- winapp manifest update-assets # Generate icon sizes

Next Steps:
1. Build your Flutter app: flutter build windows --release
2. Package with WinApp CLI: winapp pack "build\windows\x64\runner\Release" --cert auto
3. Or use /flutter-windows-package for guided packaging

CI/CD Integration:
- Use `microsoft/setup-WinAppCli@v1` GitHub Action
- See /flutter-winapp-setup --ci for workflow template
```

---

## macOS/Linux Setup (Steps 8-11)

### 8. Inform User About Platform Limitation

```
WinApp CLI Platform Notice
==========================

WinApp CLI is a Windows-only tool. It cannot be installed or run on macOS/Linux.

However, you can still use WinApp CLI through CI/CD pipelines!

Options:
1. CI/CD Workflow (Recommended) - Package on Windows runners
2. Local Alternative - Use `dart run msix:create` for basic unsigned MSIX
3. Remote Windows Machine - RDP/SSH to Windows for local testing

Generating CI/CD workflow...
```

### 9. Generate GitHub Actions Workflow

Create `.github/workflows/windows-package.yml`:

```yaml
# .github/workflows/windows-package.yml
# Generated by /flutter-winapp-setup for macOS/Linux developers
# Uses WinApp CLI on Windows runner for packaging

name: Windows Package

on:
  workflow_dispatch:  # Manual trigger
    inputs:
      sign:
        description: 'Sign the package'
        required: false
        default: 'true'
        type: boolean
  push:
    tags:
      - 'v*'

jobs:
  package:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup WinApp CLI
        uses: microsoft/setup-WinAppCli@v1

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.24.0'
          channel: 'stable'

      - name: Install dependencies
        run: flutter pub get

      - name: Build Windows release
        run: flutter build windows --release

      - name: Generate development certificate
        if: ${{ inputs.sign == 'true' || github.ref_type == 'tag' }}
        run: winapp cert generate

      - name: Generate icon assets
        run: |
          if (Test-Path "assets/app_icon.png") {
            winapp manifest update-assets assets/app_icon.png
          }

      - name: Package as MSIX
        run: |
          winapp pack "build\windows\x64\runner\Release" --cert auto

      - name: Upload MSIX artifact
        uses: actions/upload-artifact@v4
        with:
          name: windows-msix
          path: "*.msix"

      - name: Upload unsigned EXE (portable)
        uses: actions/upload-artifact@v4
        with:
          name: windows-portable
          path: build/windows/x64/runner/Release/
```

### 10. Create Local Build Script

Create `scripts/build_windows_ci.sh` for triggering CI builds:

```bash
#!/bin/bash
# scripts/build_windows_ci.sh
# Trigger Windows packaging via GitHub Actions

echo "Windows Packaging via CI/CD"
echo "============================"
echo ""
echo "WinApp CLI requires Windows. Using GitHub Actions for packaging."
echo ""

# Check if gh CLI is available
if ! command -v gh &> /dev/null; then
    echo "GitHub CLI (gh) not found. Install with: brew install gh"
    echo ""
    echo "Manual trigger:"
    echo "  1. Go to: https://github.com/YOUR_ORG/YOUR_REPO/actions"
    echo "  2. Select 'Windows Package' workflow"
    echo "  3. Click 'Run workflow'"
    exit 1
fi

# Trigger workflow
echo "Triggering Windows Package workflow..."
gh workflow run windows-package.yml

echo ""
echo "Workflow triggered! Check status with: gh run list --workflow=windows-package.yml"
```

### 11. Output Summary (macOS/Linux)

```
WinApp CLI CI/CD Setup Complete
================================

Platform: macOS/Linux (WinApp CLI not available locally)
Solution: GitHub Actions with Windows runner

Files Created:
- .github/workflows/windows-package.yml

Workflow Features:
- Uses microsoft/setup-WinAppCli@v1 action
- Builds Flutter Windows release
- Generates development certificate
- Packages as signed MSIX
- Uploads artifacts

Trigger Options:
1. Push a version tag: git tag v1.0.0 && git push --tags
2. Manual trigger: gh workflow run windows-package.yml
3. GitHub UI: Actions tab → Windows Package → Run workflow

Local Alternative (Unsigned):
If you need local MSIX creation without signing:
  1. Add to pubspec.yaml:
     dev_dependencies:
       msix: ^3.16.0
  2. Run: dart run msix:create

Note: Unsigned MSIX requires Developer Mode or certificate installation.

Next Steps:
1. Commit and push the workflow file
2. Test with: gh workflow run windows-package.yml
3. Download artifacts from Actions tab
```

---

## Troubleshooting

### Windows Issues

```powershell
# winget not found
# Solution: Install App Installer from Microsoft Store

# WinApp CLI not in PATH after install
# Solution: Restart terminal or run:
$env:Path = [System.Environment]::GetEnvironmentVariable("Path","Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path","User")

# Certificate generation fails
# Solution: Run as administrator or check certificate store permissions
winapp cert generate --verbose

# SDK not found
# Solution: Install Windows SDK via Visual Studio Installer
winapp restore
```

### macOS/Linux Issues

```bash
# "WinApp CLI not available"
# This is expected - WinApp CLI is Windows-only
# Use --ci flag to generate CI/CD workflow:
/flutter-winapp-setup --ci

# GitHub Actions workflow fails
# Check that flutter-action and setup-WinAppCli actions are accessible
# Verify repository has Actions enabled

# Need to test locally on macOS/Linux
# Use the msix Dart package for basic MSIX creation (unsigned):
dart pub add --dev msix
dart run msix:create
```

### CI/CD Issues

```yaml
# Action not found: microsoft/setup-WinAppCli@v1
# Ensure you're using the correct action name and version
# Check: https://github.com/microsoft/setup-WinAppCli

# Signing fails in CI
# Self-signed certificates work for development
# For production, use Azure Code Signing or import PFX secret:
#   - name: Import certificate
#     run: |
#       echo "${{ secrets.CERTIFICATE_BASE64 }}" | base64 -d > cert.pfx
#       winapp sign --cert cert.pfx --password "${{ secrets.CERT_PASSWORD }}"
```

## Agent Reference

For comprehensive Windows platform guidance, consult the `flutter-windows-platform` agent.
